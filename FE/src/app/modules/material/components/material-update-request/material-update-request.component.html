<div class="function-list" style="display: flex; justify-content: space-between; align-items: center;">
    <div class="left-group" style="display: flex; align-items: center; gap: 15px;">
        <div>
            <h2>Quản lý đề nghị cập nhật vật tư</h2>
        </div>
        <div style="margin: 0 10px;">
            <h2>|</h2>
        </div>
    </div>

    <div class="right-group" style="display: flex; align-items: center; gap: 15px; margin-right: 15px;">

        <div>
            <button type="button" (click)="export()" class="btn btn-danger" mat-raised-button><mat-icon>
                    file_download</mat-icon>Xuất Excel</button>
        </div>
    </div>
</div>

<div>
    <table mat-table [dataSource]="dataSource_update_manage" multiTemplateDataRows
        class="mat-elevation-z8 bordered-table">

        <ng-container matColumnDef="detail">
            <th mat-header-cell *matHeaderCellDef style="width: 25px; background-color:rgb(49, 110, 241)">
                <div
                    style=" color: white;display: flex; flex-direction: column; align-items: center;text-align: center;">
                    <span>Chi tiết</span>
                    <div class="custom-checkbox-wrapper">
                    </div>
                </div>
            </th>
            <td style="text-align: center;" mat-cell *matCellDef="let element; let i = index">
                <div class="td-flex-center">
                    <button mat-icon-button (click)="toggleRowExpansion(element)"
                        [attr.aria-label]="'Toggle details for ' + element.requestID">
                        <mat-icon>{{expandedElement === element ? 'keyboard_arrow_down' :
                            'keyboard_arrow_right'}}</mat-icon>
                    </button>
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef class="search-header" style=" background-color:rgb(49, 110, 241) ;">
                <div class="header-content">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div class="column-title">
                            Trạng thái
                        </div>
                        <div>
                            <mat-icon style="color: white;">filter_list</mat-icon>
                        </div>
                    </div>

                    <div class="search-container">
                        <div class="custom-search-wrapper">

                            <input type="text" class="custom-search-input" placeholder="Search" style="width: 100%;"
                                (keyup)="applyFilter('status', $event)">
                        </div>
                    </div>
                </div>
            </th>
            <td mat-cell *matCellDef="let element"> {{element['status']}} </td>
        </ng-container>

        <ng-container matColumnDef="createdTime">
            <th mat-header-cell *matHeaderCellDef mat-sort-header style=" background-color:rgb(49, 110, 241) ;">
                <div class="th-container">
                    <div class="header-content">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div class="column-title">
                                Ngày gửi đề nghị
                            </div>
                            <div>
                                <mat-icon style="color: white;">filter_list</mat-icon>
                            </div>
                        </div>

                        <div class="search-container">
                            <div class="custom-search-wrapper">

                                <input type="text" class="custom-search-input" placeholder="Search"
                                    (keyup)="applyFilter('createdTime', $event)">
                            </div>
                        </div>
                    </div>
                </div>

            </th>
            <td mat-cell *matCellDef="let element"> {{element['createdTime']}} </td>
        </ng-container>

        <ng-container matColumnDef="updatedBy">
            <th mat-header-cell *matHeaderCellDef mat-sort-header style=" background-color:rgb(49, 110, 241)">
                <div class="th-container">
                    <div class="header-content">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div class="column-title">
                                Người gửi đề nghị
                            </div>
                            <div>
                                <mat-icon style="color: white;">filter_list</mat-icon>
                            </div>
                        </div>

                        <div class="search-container">
                            <div class="custom-search-wrapper">

                                <input type="text" class="custom-search-input" placeholder="Search"
                                    (keyup)="applyFilter('updatedBy', $event)">
                            </div>
                        </div>
                    </div>
                </div>
            </th>
            <td mat-cell *matCellDef="let element"> {{element['updatedBy']}} </td>
        </ng-container>

        <ng-container matColumnDef="requestCode">
            <th mat-header-cell *matHeaderCellDef style=" background-color:rgb(49, 110, 241)">
                <div class="th-container">
                    <div class="header-content">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div class="column-title">
                                Yêu cầu
                            </div>
                            <div>
                                <mat-icon style="color: white;">filter_list</mat-icon>
                            </div>
                        </div>

                        <div class="search-container">
                            <div class="custom-search-wrapper">

                                <input type="text" class="custom-search-input" placeholder="Search"
                                    (keyup)="applyFilter('requestCode', $event)">
                            </div>
                        </div>
                    </div>
                </div>
            </th>
            <td mat-cell *matCellDef="let element"> {{element['requestCode']}} </td>
        </ng-container>

        <ng-container matColumnDef="approvedBy">
            <th mat-header-cell *matHeaderCellDef style=" background-color:rgb(49, 110, 241)">
                <div class="th-container">
                    <div class="header-content">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div class="column-title">
                                Người duyệt
                            </div>
                            <div>
                                <mat-icon style="color: white;">filter_list</mat-icon>
                            </div>
                        </div>

                        <div class="search-container">
                            <div class="custom-search-wrapper">

                                <input type="text" class="custom-search-input" placeholder="Search"
                                    (keyup)="applyFilter('approvedBy', $event)">
                            </div>
                        </div>
                    </div>
                </div>
            </th>
            <td mat-cell *matCellDef="let element"> {{element['approvedBy']}} </td>
        </ng-container>

        <ng-container matColumnDef="updatedTime">
            <th mat-header-cell *matHeaderCellDef style=" background-color:rgb(49, 110, 241)">
                <div class="th-container">
                    <div class="header-content">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div class="column-title">
                                Thời gian update
                            </div>
                            <div>
                                <mat-icon style="color: white;">filter_list</mat-icon>
                            </div>
                        </div>
                        <div class="column-title">

                        </div>
                        <div class="search-container">
                            <div class="custom-search-wrapper">

                                <input type="text" class="custom-search-input" placeholder="Search"
                                    (keyup)="applyFilter('updatedTime', $event)">
                            </div>
                        </div>
                    </div>
                </div>
            </th>
            <td mat-cell *matCellDef="let element"> {{element['updatedTime']}} </td>
        </ng-container>

        <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef style="width: 25px; background-color:rgb(49, 110, 241)">
                <div
                    style=" color: white;display: flex; flex-direction: column; align-items: center;text-align: center;">
                    <span>Thao tác</span>
                    <div class="custom-checkbox-wrapper">
                    </div>
                </div>
            </th>
            <td style="text-align: center;" mat-cell *matCellDef="let element; let i = index">

                <div style="display: flex; align-items: center; gap: 3px;">
                    <div>
                        <button (click)="refuseRequest(element['requestID'])"
                            style="width: 120px; background-color: rgb(245, 64, 32); color: white; font-weight: bolder;padding-bottom: 0px;"
                            type="button; " class="btn btn-danger" mat-raised-button>Từ chối</button>
                    </div>
                    <div>
                        <button (click)="acceptRequest(element['requestID'])"
                            style="width: 120px; background-color: rgb(20, 202, 62); color: white; font-weight: bolder;"
                            type="button" class="btn btn-danger" mat-raised-button>Chấp thuận</button>
                    </div>
                </div>
            </td>
        </ng-container>
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
                <div class="example-element-detail"
                    [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">

                    <div
                        style="display: flex; justify-content: space-between; align-items: center;margin-top: 0px ;padding: 10px; border-bottom: 1px solid rgba(0,0,0,.12);">
                        <h2>Danh sách cập nhật chi tiết</h2>
                        <button mat-raised-button color="primary" (click)="exportExpandedDetails(element)">
                            <mat-icon>file_download</mat-icon>
                            Xuất Excel
                        </button>
                    </div>

                    <table mat-table [dataSource]="dataSoure_update_detail" class="mat-elevation-z8 bordered-table">

                        <ng-container matColumnDef="select">
                            <th mat-header-cell *matHeaderCellDef style="text-align: center;">
                                <div style="display: flex; flex-direction: column; align-items: center;">
                                    <span>Select all</span>
                                </div>
                                <mat-checkbox color="primary" (click)="$event.stopPropagation()"
                                    (change)="$event ? toggleAllRows() : null"
                                    [checked]="selection.hasValue() && isAllSelected()"
                                    [indeterminate]="selection.hasValue() && !isAllSelected()"
                                    [aria-label]="checkboxLabel()">
                                </mat-checkbox>
                            </th>
                            <td style="text-align: center;" mat-cell *matCellDef="let row">
                                <mat-checkbox color="primary" (click)="$event.stopPropagation()"
                                    (change)="$event ? selection.toggle(row) : null"
                                    [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                                </mat-checkbox>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="materialId">
                            <th mat-header-cell *matHeaderCellDef> Material ID </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['materialId']}} </td>
                        </ng-container>

                        <ng-container matColumnDef="updatedBy">
                            <th mat-header-cell *matHeaderCellDef> Update By </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['updatedBy']}} </td>
                        </ng-container>

                        <ng-container matColumnDef="createdTime">
                            <th mat-header-cell *matHeaderCellDef> Created Time </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['createdTime']}} </td>
                        </ng-container>

                        <ng-container matColumnDef="updatedTime">
                            <th mat-header-cell *matHeaderCellDef> Updated Time </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['updatedTime']}} </td>
                        </ng-container>

                        <ng-container matColumnDef="productCode">
                            <th mat-header-cell *matHeaderCellDef> Code vật tư </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['productCode'] | date:
                                'dd/MM/yyyy'}} </td> <!-- Ví dụ có pipe date -->
                        </ng-container>

                        <ng-container matColumnDef="productName">
                            <th mat-header-cell *matHeaderCellDef> Tên vật tư </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['productName']}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="quantity">
                            <th mat-header-cell *matHeaderCellDef> Số lượng </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['quantity']}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="type">
                            <th mat-header-cell *matHeaderCellDef> Loại yêu cầu </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['type']}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="locationId">
                            <th mat-header-cell *matHeaderCellDef> Location ID </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['locationId']}}
                            </td>
                        </ng-container>
                         <ng-container matColumnDef="locationName">
                            <th mat-header-cell *matHeaderCellDef> Tên kho </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['locationName']}}
                            </td>
                        </ng-container>
                         <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef> Status </th>
                            <td mat-cell *matCellDef="let innerElement"> {{innerElement['status']}}
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumnsDetails"></tr>
                        <tr mat-row *matRowDef="let innerRow; columns: displayedColumnsDetails;"></tr>
                    </table>
                </div>
            </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

        <!-- <tr mat-row *matRowDef="let element; columns: displayedColumns;" class="element-row"
            [class.expanded-row]="expandedElement === element">
        </tr> -->

        <tr mat-row *matRowDef="let element; columns: displayedColumns;" class="example-element-row"
            [class.example-expanded-row]="expandedElement === element">
        </tr>

        <!-- <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr> -->
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>

        <!-- <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr> -->
        <!-- <tr mat-row 
                *matRowDef="let row; columns: ['expandedDetail']; when: isExpansionDetailRow" 
                class="detail-row">
            </tr> -->

    </table>
</div>