<div class="area-container">
    <!-- Header -->
    <div class="area-header">
        <div class="header-title">
            <mat-icon class="title-icon">map</mat-icon>
            <div>
                <h1>Quản lý kho</h1>
                <p class="subtitle">Warehouse Management</p>
            </div>
        </div>
        <button mat-raised-button color="primary" class="add-btn" [routerLink]="'/areas/add-new'">
            <mat-icon>add_circle</mat-icon>
            Thêm mới kho
        </button>
    </div>

    <!-- Content Card -->
    <mat-card class="area-card">
        <!-- Table Header -->
        <div class="table-header">
            <div class="table-title">
                <mat-icon>list</mat-icon>
                <span>Danh sách kho ({{totalItems}})</span>
            </div>
            <div class="table-actions">
                <button mat-raised-button (click)="onRefresh()" class="refresh-btn icon-only" matTooltip="Làm mới">
                    <mat-icon color="primary">sync</mat-icon>
                </button>
            </div>
        </div>

        <!-- Table -->
        <div class="table-container desktop-view">
            <table mat-table [dataSource]="getPagedAreas()" class="area-table">
                <!-- ID Column -->
                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef>ID</th>
                    <td mat-cell *matCellDef="let area">{{area.id}}</td>
                </ng-container>

                <!-- Code Column -->
                <ng-container matColumnDef="code">
                    <th mat-header-cell *matHeaderCellDef>
                        <div>Mã kho</div>
                        <mat-form-field class="search-field" appearance="outline">
                            <input matInput [(ngModel)]="filterValues.code" (keyup.enter)="applyFilter()">
                        </mat-form-field>
                    </th>
                    <td mat-cell *matCellDef="let area">{{area.code}}</td>
                </ng-container>


                <!-- Name Column -->
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef>
                        <div>Tên kho</div>
                        <mat-form-field class="search-field" appearance="outline">
                            <input matInput [(ngModel)]="filterValues.name" (keyup.enter)="applyFilter()">
                        </mat-form-field>
                    </th>
                    <td mat-cell *matCellDef="let area">{{area.name}}</td>
                </ng-container>

                <!-- Type Column -->
                <!-- <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef>
                        <div>Type</div>
                    </th>
                    <td mat-cell *matCellDef="let area">
                        <span class="type-badge">
                            {{area.type}}
                        </span>
                    </td>
                </ng-container> -->

                <!-- storekeeper Column -->
                <ng-container matColumnDef="storekeeper">
                    <th mat-header-cell *matHeaderCellDef>
                        <div>Thủ kho</div>
                        <mat-form-field class="search-field" appearance="outline">
                            <input matInput [(ngModel)]="filterValues.storekeeper" (keyup.enter)="applyFilter()">
                        </mat-form-field>
                    </th>
                    <td mat-cell *matCellDef="let item">{{item.storekeeper}}</td>
                </ng-container>
                <ng-container matColumnDef="address">
                    <th mat-header-cell *matHeaderCellDef>
                        <div>Địa chỉ</div>
                        <mat-form-field class="search-field" appearance="outline">
                            <input matInput [(ngModel)]="filterValues.address" (keyup.enter)="applyFilter()">
                        </mat-form-field>
                    </th>
                    <td mat-cell *matCellDef="let item">{{item.address}}</td>
                </ng-container>
                <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef>
                        <div>Ghi chú</div>
                        <mat-form-field class="search-field" appearance="outline">
                            <input matInput [(ngModel)]="filterValues.description" (keyup.enter)="applyFilter()">
                        </mat-form-field>
                    </th>
                    <td mat-cell *matCellDef="let item">{{item.description}}</td>
                </ng-container>

                <!-- Racks Column -->
                <!-- <ng-container matColumnDef="locationsQty">
                    <th mat-header-cell *matHeaderCellDef>Số lượng locations</th>
                    <td mat-cell *matCellDef="let item of area">{{item.locationsQty}}</td>
                </ng-container> -->

                <!-- Multi Column -->
                <ng-container matColumnDef="is_active">
                    <th mat-header-cell *matHeaderCellDef>
                        <div>Trạng thái</div>
                        <mat-form-field class="search-field" appearance="outline">
                            <mat-select [(ngModel)]="filterValues.is_active" (selectionChange)="applyFilter()"
                                placeholder="Chọn loại">
                                <mat-option value="">Tất cả</mat-option>
                                <mat-option value="true">Hoạt động</mat-option>
                                <mat-option value="false">Không hoạt động</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </th>
                    <td mat-cell *matCellDef="let area">
                        <span class="status-badge" [ngClass]="getStatusClass(area.is_active)">
                            {{ getStatusLabel(area.is_active) }}
                        </span>
                    </td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef class="text-center">Options</th>
                    <td mat-cell *matCellDef="let area" class="text-center">
                        <button mat-mini-fab class="action-btn edit-btn" [routerLink]="['/areas/add-new', area.id]"
                            matTooltip="Chỉnh sửa">
                            <mat-icon>edit_note</mat-icon>
                        </button>
                        <button mat-mini-fab class="action-btn"
                            [ngClass]="area.is_active ? 'delete-btn' : 'restore-btn'" (click)="onDelete(area)">
                            <mat-icon>{{ area.is_active ? 'block' : 'check_circle' }}</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
            </table>
        </div>

        <!-- mobile -->
        <div class="mobile-view">
            <!-- Mobile Filter Toggle Button -->
            <div class="mobile-filter-toggle">
                <button mat-stroked-button (click)="toggleMobileFilters()" class="filter-toggle-btn">
                    <mat-icon>filter_list</mat-icon>
                    Bộ lọc
                    <mat-icon class="toggle-icon">{{showMobileFilters ? 'expand_less' : 'expand_more'}}</mat-icon>
                </button>
            </div>

            <!-- Mobile Filters Panel (Collapsible) -->
            <div class="mobile-filters" [class.show]="showMobileFilters">
                <mat-form-field class="filter-field" appearance="outline">
                    <mat-label>Mã kho</mat-label>
                    <input matInput [(ngModel)]="filterValues.code" (keyup.enter)="applyFilter()">
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>

                <mat-form-field class="filter-field" appearance="outline">
                    <mat-label>Tên kho</mat-label>
                    <input matInput [(ngModel)]="filterValues.name" (keyup.enter)="applyFilter()">
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>

                <mat-form-field class="filter-field" appearance="outline">
                    <mat-label>Thủ kho</mat-label>
                    <input matInput [(ngModel)]="filterValues.storekeeper" (keyup.enter)="applyFilter()">
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>

                <mat-form-field class="filter-field" appearance="outline">
                    <mat-label>Trạng thái</mat-label>
                    <mat-select [(ngModel)]="filterValues.is_active" (selectionChange)="applyFilter()">
                        <mat-option value="">Tất cả</mat-option>
                        <mat-option value="true">Hoạt động</mat-option>
                        <mat-option value="false">Không hoạt động</mat-option>
                    </mat-select>
                </mat-form-field>

                <div class="filter-actions">
                    <button mat-button (click)="clearFilters()">
                        <mat-icon>clear</mat-icon>
                        Xóa bộ lọc
                    </button>
                    <button mat-raised-button color="primary" (click)="applyFilter(); toggleMobileFilters()">
                        <mat-icon>check</mat-icon>
                        Áp dụng
                    </button>
                </div>
            </div>

            <!-- Mobile Card List -->
            <div class="mobile-card-list">
                <mat-card class="mobile-area-card" *ngFor="let item of areas">
                    <!-- Card Header -->
                    <div class="mobile-card-header">
                        <div class="card-id">
                            <mat-icon class="id-icon">tag</mat-icon>
                            <span>#{{item.id}}</span>
                        </div>
                        <span [ngClass]="getStatusClass(item.is_active)">
                            {{ getStatusLabel(item.is_active) }}
                        </span>
                    </div>

                    <!-- Card Content -->
                    <div class="mobile-card-content">
                        <div class="info-row">
                            <div class="info-label">
                                <mat-icon>qr_code_2</mat-icon>
                                <span>Mã kho</span>
                            </div>
                            <div class="info-value">{{item.code}}</div>
                        </div>

                        <div class="info-row">
                            <div class="info-label">
                                <mat-icon>location_on</mat-icon>
                                <span>Tên kho</span>
                            </div>
                            <div class="info-value">{{item.name}}</div>
                        </div>

                        <!-- <div class="info-row">
                            <div class="info-label">
                                <mat-icon>category</mat-icon>
                                <span>Type</span>
                            </div>
                            <div class="info-value">
                                <span class="type-badge">{{item.type}}</span>
                            </div>
                        </div> -->

                        <div class="info-row">
                            <div class="info-label">
                                <mat-icon>person</mat-icon>
                                <span>Thủ kho</span>
                            </div>
                            <div class="info-value">{{item.storekeeper || 'N/A'}}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">
                                <mat-icon>apartment</mat-icon>
                                <span>Địa chỉ</span>
                            </div>
                            <div class="info-value">{{item.address}}</div>
                        </div>

                        <!-- <div class="info-row">
                            <div class="info-label">
                                <mat-icon>inventory_2</mat-icon>
                                <span>Số lượng locations</span>
                            </div>
                            <div class="info-value">
                                <span class="quantity-badge">{{item.locationsQty || 0}}</span>
                            </div>
                        </div> -->
                    </div>

                    <!-- Card Actions -->
                    <div class="mobile-card-actions">
                        <button mat-stroked-button color="primary" [routerLink]="['/area/add-new', item.id]">
                            <mat-icon>edit</mat-icon>
                            Chỉnh sửa
                        </button>
                        <button mat-stroked-button [color]="item.is_active ? 'warn' : 'accent'"
                            (click)="onDelete(item)">
                            <mat-icon>{{ item.is_active ? 'block' : 'check_circle' }}</mat-icon>
                            {{ item.is_active ? 'Vô hiệu hóa' : 'Kích hoạt' }}
                        </button>
                    </div>
                </mat-card>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <mat-form-field class="page-size-select" appearance="outline">
                <mat-select [(ngModel)]="pageSize">
                    <mat-option [value]="10">10</mat-option>
                    <mat-option [value]="25">25</mat-option>
                    <mat-option [value]="50">50</mat-option>
                    <mat-option [value]="100">100</mat-option>
                </mat-select>
            </mat-form-field>

            <div class="pagination-buttons">
                <button *ngFor="let page of [].constructor(totalPages); let i = index" mat-button
                    [class.page-active]="currentPage === i + 1" (click)="onPageChange(i + 1)">
                    {{ i + 1 }}
                </button>
            </div>
        </div>
    </mat-card>
</div>